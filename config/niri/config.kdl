// Niri configuration - Rose Pine Moon theme

// Startup
spawn-at-startup "foot" "--server"
spawn-at-startup "wl-paste" "--watch" "cliphist" "store"
// spawn-at-startup "swaybg" "-i" "/home/jofre/.dotfiles/config/nix/theme/wallpaper.jpg" "-m" "fill"

prefer-no-csd

screenshot-path "~/Pictures/Screenshots/Screenshot %Y-%m-%d %H-%M-%S.png"

hotkey-overlay {
    skip-at-startup
}

environment {
    NIXOS_OZONE_WL "1"
    XCURSOR_SIZE "24"
    QT_CURSOR_SIZE "24"
}

cursor {
    xcursor-theme "Vanilla-DMZ"
    xcursor-size 24
    hide-when-typing
}

input {
    keyboard {
        xkb {
            layout "us,ca"
            options "caps:escape"
        }
        repeat-delay 250
        repeat-rate 30
    }

    touchpad {
        tap
        natural-scroll
    }
}

// Monitors - niri ignores disconnected outputs
output "HDMI-A-1" {
    mode "1920x1080"
    position x=0 y=0
}

output "eDP-1" {
    mode "1920x1080@60.000"
    position x=0 y=1080
}

layout {
    gaps 0

    center-focused-column "never"

    default-column-width { proportion 1.0; }

    focus-ring {
        width 0
        active-color "#c4a7e7"
        inactive-color "#6e6a86"
        urgent-color "#eb6f92"
    }

    border {
        off
    }

    shadow {
        off
    }
}

animations {
    off
}

// Named workspaces (W/H/M/D/F/I/E)
workspace "web"
workspace "browse"
workspace "mail"
workspace "dev"
workspace "files"
workspace "info"
workspace "edit"

// Window rules
window-rule {
    match app-id="launcher"
    open-floating true
}

window-rule {
    match app-id="firefox"
    open-on-workspace "web"
}

window-rule {
    match app-id="chromium-browser"
    open-on-workspace "browse"
}

window-rule {
    match app-id="thunderbird"
    open-on-workspace "mail"
}

window-rule {
    match app-id="DBeaver"
    open-on-workspace "dev"
}

window-rule {
    match app-id="code"
    open-on-workspace "edit"
}

// Keybindings
binds {
    // Window management
    Mod+Q { close-window; }

    // Launchers
    Mod+Return { spawn "footclient"; }
    Mod+O { spawn "bash" "/home/jofre/.dotfiles/scripts/apps-launcher.sh"; }
    Mod+K { spawn "bash" "/home/jofre/.dotfiles/scripts/bookmarks-launcher.sh"; }
    Mod+P { spawn "bash" "/home/jofre/.dotfiles/scripts/passwords-launcher.sh"; }
    Mod+X { spawn "bash" "/home/jofre/.dotfiles/scripts/commands-launcher.sh"; }
    Mod+C { spawn "bash" "/home/jofre/.dotfiles/scripts/clipboard-launcher.sh"; }

    // Credentials
    Mod+A { spawn "bash" "-c" "wtype -M alt $(cat /tmp/username) -m alt"; }
    Mod+S { spawn "bash" "-c" "wtype -M alt $(cat /tmp/password) -m alt"; }

    // Column/window navigation
    Mod+J { focus-column-left; }
    Mod+L { focus-column-right; }
    Mod+Shift+J { move-column-left; }
    Mod+Shift+L { move-column-right; }

    // Window focus within column
    Mod+Shift+K { focus-window-down; }
    Mod+Shift+I { focus-window-up; }

    // Resize
    Mod+Minus { set-column-width "-10%"; }
    Mod+Equal { set-column-width "+10%"; }

    // Fullscreen / maximize
    Mod+Shift+F { fullscreen-window; }
    Mod+Shift+M { maximize-column; }

    // Workspaces
    Mod+W { focus-workspace "web"; }
    Mod+H { focus-workspace "browse"; }
    Mod+M { focus-workspace "mail"; }
    Mod+D { focus-workspace "dev"; }
    Mod+F { focus-workspace "files"; }
    Mod+I { focus-workspace "info"; }
    Mod+E { focus-workspace "edit"; }

    // Move window to workspace
    Mod+Shift+W { move-window-to-workspace "web"; }
    Mod+Shift+H { move-window-to-workspace "browse"; }
    Mod+Shift+D { move-window-to-workspace "dev"; }
    Mod+Shift+E { move-window-to-workspace "edit"; }

    // Brightness
    Mod+Left { spawn "brightnessctl" "set" "5%-"; }
    Mod+Right { spawn "brightnessctl" "set" "+5%"; }

    // Volume
    Mod+Up { spawn "pactl" "set-sink-volume" "@DEFAULT_SINK@" "+5%"; }
    Mod+Down { spawn "pactl" "set-sink-volume" "@DEFAULT_SINK@" "-5%"; }

    // Screenshots
    Print { screenshot; }
    Ctrl+Print { screenshot-screen; }
    Alt+Print { screenshot-window; }

    // Help
    Mod+Shift+Slash { show-hotkey-overlay; }

    // Mouse
    Mod+WheelScrollDown cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp cooldown-ms=150 { focus-workspace-up; }
}
